var FEL=function(){var selector={menu:{main:".fel.menu",pageMenu:"#pageMenu",pageSection:".menu-page-section",subSection:".menu-sub-section li a",burgerButton:".fel.burger",burgerClose:".fel.burger-close",scrollspyOffset:100},gitFeed:{feedURL:"https://bitbucket.org/sni-digital/food-fdc-main/rss?token=d99831075e4a5a51e5c6ef8784fffb0b",commitFeed:"#commitFeed",loader:"#commitFeed .loader",feedPoster:".feed.poster"},page:{title:".page-title",waypoint:".waypoint"},clipboard:{copyIcon:".fel.icon",copiedClass:"copied"},unsplash:{apiURL:"https://api.unsplash.com/photos/random/",clientId:"4a87ae39938bbb9e24193562238f38f3d094187d52935357e07ed52001d36bf4",collection:"160236",backgroundClass:".fel-example.img, .btn-blur"},animateSpeed:300},setEventHandlers=function(){var menu=selector.menu,$menu=$(menu.main),$burger=$(menu.burgerButton),$burgerClose=$(menu.burgerClose);$burger.on("click",function(){$menu.addClass("show")}),$burgerClose.on("click",function(){$menu.removeClass("show")}),$(function(){var menu=selector.menu;$(selector.page.title).on("scrollSpy:exit",function(){$(menu.main).addClass("stuck")}).on("scrollSpy:enter",function(){$(menu.main).removeClass("stuck")}).scrollSpy(),$("body").scrollSpy({target:"#pageMenu"})})},renderGitLog=function(){$("body").hasClass("home")&&(feedDateFormat="ddd HH:mm:ss",feedOuter='<ol class="fel updateFeed">{entries}</ol>',feedInner='<li class="fel"><h3 class="fel"><a class="fel feed title" href="{url}" target="_blank">{title}</a></h3><span class="fel feed poster">{author}</span><small class="fel feed timestamp">{date}</small></li>',gitFeed=selector.gitFeed,$(function(){$(gitFeed.commitFeed).rss(gitFeed.feedURL,{limit:10,ssl:!0,layoutTemplate:feedOuter,entryTemplate:feedInner,dateFormat:feedDateFormat,effect:"slideFast",dateLocale:"en",onData:function(){$(gitFeed.loader).fadeOut()}},function(){$(gitFeed.feedPoster).each(function(i){var $poster=$(this),txt=$poster.text();txt=txt.replace("noreply@bitbucket.org (","").replace(")","").replace("Yona ","Yonas "),$poster.text(txt),console.log(txt)})})}))},fetchUnsplash=function(){var $us=$(selector.unsplash.backgroundClass);0!=$us.length&&(console.log("Found "+$us.length+" image divs. Fetching from Unsplash"),$.getJSON(selector.unsplash.apiURL,{client_id:selector.unsplash.clientId,collections:selector.unsplash.collection,w:$(window).width().toString()}).done(function(data){$(selector.unsplash.backgroundClass).css("background-image",'url("'+data.urls.custom+'")')}))},setUpClipboard=function(){var clippy=new Clipboard(selector.clipboard.copyIcon);clippy.on("success",function(e){console.log(e);var $dupe=$(e.trigger.firstElementChild);$dupe.clone().appendTo(e.trigger).addClass(selector.clipboard.copiedClass).animate({opacity:0,fontSize:"150px"},selector.animateSpeed,function(){this.remove()})})},setUpScrollspy=function(){console.log("Starting Scrollspy...");var lastId,subLastId,menuItems=($(selector.menu.pageMenu),$(selector.menu.pageSection)),childMenuItems=$(selector.menu.subSection),scrollItems=menuItems.map(function(){var item=$($(this).attr("href"));return item.length?item:void 0});subScrollItems=childMenuItems.map(function(){var item=$($(this).attr("href"));return item.length?item:void 0}),console.log("Found "+menuItems.length+" menu items"),console.log("Found "+childMenuItems.length+" child menu items"),menuItems.click(function(e){var href=$(this).attr("href"),offsetTop="#"===href?0:$(href).offset().top;$("html, body").stop().animate({scrollTop:offsetTop},selector.animateSpeed),e.preventDefault()}),childMenuItems.click(function(e){var href=$(this).attr("href"),offsetTop="#"===href?0:$(href).offset().top;$("html, body").stop().animate({scrollTop:offsetTop},selector.animateSpeed),e.preventDefault()}),$(window).scroll(function(){var fromTop=$(this).scrollTop()+selector.menu.scrollspyOffset,cur=scrollItems.map(function(){return $(this).offset().top<fromTop?this:void 0});cur=cur[cur.length-1];var id=cur&&cur.length?cur[0].id:"";lastId!==id&&(lastId=id,console.log("now in #"+id),menuItems.parent().removeClass("active").end().filter("[href='#"+id+"']").parent().addClass("active"));var subCur=subScrollItems.map(function(){return $(this).offset().top<fromTop?this:void 0});subCur=subCur[subCur.length-1];var subId=subCur&&subCur.length?subCur[0].id:"";subLastId!==subId&&childMenuItems.parent().removeClass("active").end().filter("[href='#"+subId+"']").parent().addClass("active")})};return{init:function(){setEventHandlers(),renderGitLog(),fetchUnsplash(),setUpClipboard(),setUpScrollspy()}}}();$(document).ready(function(){FEL.init()});